---
title: "Anomaly Detection with Domain Adaptation(CVPR2023)"
date: "2025-06-15"
tags: ['anomaly detection', 'domain adaptation', 'semi-supervised', 'IRAD']
draft: false
summary: "Invariant Representation Anomaly Detection(IRAD)ì„ í†µí•œ limited target ë°ì´í„° í™˜ê²½ì—ì„œ anomaly detectionì„ ì§„í–‰í•˜ëŠ” ë…¼ë¬¸ ë¦¬ë·°"
---

# Anomaly Detection with Domain Adaptation

Semi-supervised anomaly detection ë¬¸ì œëŠ” target ë„ë©”ì¸ì—ì„œ ë¼ë²¨ë§ëœ ë°ì´í„°ê°€ ì œí•œì ì¸ ìƒí™©ì—ì„œ ì •ìƒê³¼ ë¹„ì •ìƒ ë°ì´í„°ë¥¼ ë¶„ë¥˜í•´ì•¼ í•œë‹¤ëŠ” ì ì—ì„œ ì–´ë ¤ì›€ì´ í¬ë‹¤.  
íŠ¹íˆ, source ë„ë©”ì¸ì—ì„œëŠ” ì •ìƒ(normal) ë°ì´í„°ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , target ë„ë©”ì¸ì—ì„œë„ ì¼ë¶€ ì •ìƒ ë°ì´í„°ë§Œ í™œìš© ê°€ëŠ¥í•œ ìƒí™©ì—ì„œ anomalyë¥¼ íƒì§€í•´ì•¼ í•œë‹¤ëŠ” ì ì—ì„œ, domain adaptation ê¸°ë°˜ì˜ ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œ ì„¤ì • í•˜ì—ì„œ ë³¸ ë…¼ë¬¸ì€ **IRAD(Invariant Representation Anomaly Detection)** êµ¬ì¡°ë¥¼ ì œì•ˆí•˜ë©°, shared encoderì™€ private encoderë¥¼ ê²°í•©í•œ adversarial training êµ¬ì¡°ë¥¼ í†µí•´ featureë¥¼ ë‚˜ëˆ„ê³ ì í•˜ì˜€ë‹¤.

---

# Overall Method

![method.png](/static/images/anomaly-detection-da/method.png)

ì´ êµ¬ì¡°ëŠ” ë‹¤ë¥¸ semi-supervised ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ feature extraction ê³¼ì • ì¤‘ domain adaptationì„ ê²°í•©í•˜ì—¬ target ë„ë©”ì¸ì˜ anomaly detection ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ê²ƒì´ ëª©í‘œ.  
Source dataëŠ” ImageNetìœ¼ë¡œ pre-trainedëœ ResNet-50ì„ í†µí•´ featureë¥¼ ì¶”ì¶œí•˜ë©°, normal ë°ì´í„°ë§Œ ì‚¬ìš©ëœë‹¤.  

Target ë„ë©”ì¸ì€ normal, abnormal ë°ì´í„°ë¥¼ ëª¨ë‘ í¬í•¨í•˜ë˜, í•™ìŠµ ì‹œì—ëŠ” normal ë°ì´í„°ë§Œ í™œìš©í•˜ë©°, ì´ ì—­ì‹œ ResNet ê¸°ë°˜ shared encoderë¥¼ í†µí•´ featureë¥¼ ì¶”ì¶œí•˜ê²Œ ëœë‹¤.  
ì´ëŸ¬í•œ shared featureì™€ source domain ì— íŠ¹ì§•ëœ featureë¥¼ í•¨ê»˜ í™œìš©í•˜ì—¬ generatorë¥¼ í†µí•´ì„œ target-like ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ anomaly detectionì„ ìˆ˜í–‰í•œë‹¤.

DiscriminatorëŠ” ì‚¬ì „í•™ìŠµë˜ì§€ ì•Šì€ ResNet-18ì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

---

# Problem Statements

ë³¸ ë…¼ë¬¸ì´ ë‹¤ë£¨ëŠ” ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:

- **Settings**: source ë„ë©”ì¸ê³¼ ì œí•œëœ target ë„ë©”ì¸ ë°ì´í„°ê°€ ì£¼ì–´ì§
- **Limitations**: í•™ìŠµ ì‹œì—ëŠ” sourceì™€ targetì˜ normal dataë§Œ ì‚¬ìš© ê°€ëŠ¥í•¨
- **Test Env**: test setì€ normalê³¼ abnormalì´ í˜¼í•©ë¨
- **Metric**: AUROCì„ ì‚¬ìš©í•˜ì—¬ anomaly detection ì„±ëŠ¥ì„ í‰ê°€í•¨

---

# Method
## Shared + Private Encoder

ê¸°ì¡´ì˜ domain adaptation ì—°êµ¬ì—ì„œëŠ” ë„ë©”ì¸ì´ ë‹¬ë¼ì ¸ë„ ë³€í•˜ì§€ ì•ŠëŠ” **ê³µí†µëœ feature (domain-invariant feature)** ë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ì‹ì´ ì¼ë°˜ì ì´ë‹¤.  
IRADëŠ” ì´ëŸ¬í•œ ê¸°ì¡´ ë°©ì‹ì— ê¸°ë°˜ì„ ë‘ë©´ì„œë„, **ê³µí†µ featureì™€ domain-specific featureë¥¼ ëª…í™•íˆ ë¶„ë¦¬**í•˜ëŠ” ë° ì¤‘ì ì„ ë‘”ë‹¤.

ì´ë¥¼ ìœ„í•´ shared encoderì™€ ë”ë¶ˆì–´ **private encoder**ë¥¼ ë„ì…í•˜ì˜€ìœ¼ë©°, íŠ¹íˆ source ë„ë©”ì¸ì— ëŒ€í•´ íŠ¹ì •ëœ ì •ë³´ë¥¼ ë½‘ì•„ë‚´ê¸° ìœ„í•´ adversarial training êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.

---

## Adversarial Loss

Generatorì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í•™ìŠµì´ ì§„í–‰ëœë‹¤:

1. **ê³µí†µ feature + source-specific feature (from source)** â†’ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ ìƒì„±
2. **ê³µí†µ feature (from target) + source-specific feature** â†’ ë˜ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ ìƒì„±  
   ì´ ë‘˜ì€ discriminatorë¥¼ í†µí•´ **ê°™ì€ ì´ë¯¸ì§€**ì²˜ëŸ¼ ë³´ì´ë„ë¡ ìœ ë„ëœë‹¤.
3. **random vector + shared feature (from source)** â†’ ì¶”ê°€ë¡œ í•˜ë‚˜ ìƒì„±í•˜ì—¬, private encoderê°€ ê³¼ë„í•˜ê²Œ ì˜í–¥ë ¥ì„ ê°–ì§€ ì•Šë„ë¡ ì œì–´í•œë‹¤.

DiscriminatorëŠ” ì´ ì„¸ ê°€ì§€ ì´ë¯¸ì§€ì™€ ì‹¤ì œ source ì´ë¯¸ì§€ë¥¼ êµ¬ë¶„í•˜ë„ë¡ í•™ìŠµë˜ë©°, ì´ ê³¼ì •ì„ í†µí•´ **target domainì— alignëœ feature ê³µê°„ì„ êµ¬ì¶•**í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

![loss.png](/static/images/anomaly-detection-da/loss.png)

Adversarial LossëŠ” ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì§„ì§œ source ì´ë¯¸ì§€ì²˜ëŸ¼ ë³´ì´ë„ë¡ í•™ìŠµí•˜ëŠ” ë° í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤. GANì˜ ê¸°ë³¸ ì•„ì´ë””ì–´ì— ê¸°ë°˜í•˜ì—¬, GeneratorëŠ” Discriminatorë¥¼ ì†ì´ë„ë¡ í•™ìŠµë˜ê³ , DiscriminatorëŠ” ì§„ì§œì™€ ê°€ì§œ ì´ë¯¸ì§€ë¥¼ êµ¬ë¶„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

ë‹¤ìŒì€ IRAD ë…¼ë¬¸ì—ì„œ ì •ì˜ëœ adversarial loss í•¨ìˆ˜ì´ë‹¤:


```math
\min_{E_{sh}, E_{pv}, G_{src}} \max_{D_{src}} V(D_{src}, G_{src}, E_{pv}, E_{sh}) = 
\mathbb{E}_{x_{src}}[\log D_{src}(x_{src})] + \mathbb{E}_{x_{src}}[\log(1 - D_{src}(x'_{src}))] 
+ \mathbb{E}_{x_{src}, x_{tgt}}[\log(1 - D_{src}(x'_{tgt}))] + \mathbb{E}_{x_{src}}[\log(1 - D_{src}(x_{rnd}))]
```

`x'_{src}`ëŠ” sourceì—ì„œ ìƒì„±ëœ ë³µì› ì´ë¯¸ì§€ì´ë‹¤.

`x'_{tgt}`ëŠ” sourceì˜ private featureì™€ targetì˜ shared featureë¡œë¶€í„° ìƒì„±ëœ ì´ë¯¸ì§€ì´ë‹¤.

`x_{rnd}`ëŠ” ë¬´ì‘ìœ„ zì™€ source shared featureë¡œë¶€í„° ìƒì„±ëœ ì´ë¯¸ì§€ì´ë‹¤.

ì´ëŸ¬í•œ ë‹¤ì–‘í•œ ì¡°í•©ì˜ ìƒì„± ì´ë¯¸ì§€ë¥¼ í†µí•´ DiscriminatorëŠ” ë” ê°•ë ¥í•˜ê²Œ í›ˆë ¨ë˜ê³ , Generatorì™€ EncoderëŠ” ë” ì •ë°€í•œ ìƒì„± ê²°ê³¼ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë„ë¡ í•™ìŠµëœë‹¤.

Adversarial LossëŠ” ëª¨ë¸ì´ ë³´ë‹¤ ì‹¤ì œì™€ ìœ ì‚¬í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê²Œ ë§Œë“¤ë©°, anomaly detectionì˜ ì‹ ë¢°ë„ë¥¼ ë†’ì´ëŠ” ë° ê¸°ì—¬í•œë‹¤.


---

## Cycle Consistency Loss

Cycle ConsistencyëŠ” ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì›ë˜ ì…ë ¥ì„ ì¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•´ì¤€ë‹¤. ì´ëŠ” ëª¨ë¸ì´ ì‹¤ì§ˆì ì¸ ë³€í™˜ë§Œì„ ìˆ˜í–‰í•˜ê³ , ì˜ë¯¸ ìˆëŠ” feature ê³µê°„ì„ í•™ìŠµí•˜ê²Œ ë§Œë“œëŠ” ë° ë„ì›€ì´ ëœë‹¤.

Sourceì—ì„œ ìƒì„±ëœ `x'_{src}`ëŠ” ë‹¤ì‹œ encoderì— í†µê³¼ë˜ì–´ original `x_{src}`ì™€ì˜ ìœ ì‚¬ë„ë¥¼ ìœ ì§€í•˜ë„ë¡ í•™ìŠµëœë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ, `x'_{tgt}` ì—­ì‹œ target ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ë©´ì„œë„ source ê¸°ë°˜ì˜ ìƒì„± ê²°ê³¼ê°€ ë˜ë„ë¡ ì„¤ê³„ëœë‹¤.

Cycle consistency lossëŠ” ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„ëœë‹¤:


```math
l_{cyc} = \mathbb{E}_{x_{src}} [ \| x_{src} - G(E_{pv}(x_{src}) + E_{sh}(x_{src})) \|^2 ] + \mathbb{E}_{x_{tgt}} [ \| x_{tgt} - G(E_{pv}(x_{src}) + E_{sh}(x_{tgt})) \|^2 ]
```

ì´ ì†ì‹¤ì€ ê¸°ì¡´ GAN ê¸°ë°˜ ëª¨ë¸ë“¤ì´ ê³ ì°¨ì›ì—ì„œ ë°œìƒí•˜ëŠ” mode collapse ë˜ëŠ” reconstruction fail caseë¥¼ ì™„í™”í•˜ëŠ” ë° ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤.

---

# Additional Loss - Disentanglement Loss, Similarity Loss

shared encoderì™€ private encoderê°€ **ì„œë¡œ ë‹¤ë¥¸ íŠ¹ì§•**ì„ ì¶”ì¶œí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ê° encoderì˜ ì—­í• ì„ ëª…í™•íˆ ë¶„ë¦¬í•˜ëŠ” ëª©ì ì˜ ì¶”ê°€ì ì¸ loss termì„ ë„ì…í•˜ì˜€ë‹¤.
Disentanglement LossëŠ” ê³µí†µ featureì™€ private featureì˜ ë‚´ì ì„ ìµœì†Œí™”í•¨ìœ¼ë¡œì¨ ì„œë¡œ ë‹¤ë¥¸ ì •ë³´ë§Œì„ ë‹´ë„ë¡ í•™ìŠµëœë‹¤.

###  Disentanglement Loss

```math
l_{dis} = ||E_{sh}(x_{src})^T E_{pv}(x_{src})||
```

### Similarity Loss

Similarity LossëŠ” Sourceì™€ targetì˜ shared featureê°€ ìœ ì‚¬í•œ ë°©í–¥ì„ ê°–ë„ë¡ ìœ ë„í•˜ê¸° ìœ„í•´ ë‘ ë²¡í„°ì˜ ë‚´ì ì„ ìµœëŒ€í™”í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í•™ìŠµëœë‹¤. ì´ëŠ” target ë°ì´í„°ê°€ ì ì€ ìƒí™©ì—ì„œë„ ê³µí†µ feature spaceë¥¼ íš¨ê³¼ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê¸° ìœ„í•œ í•µì‹¬ ìš”ì†Œì´ë‹¤.

```math
l_{sim} = - \left\| E_{sh}(x_{src})^T E_{sh}(x_{tgt}) \right\|
```

---

ë” ìì„¸í•œ ë‚´ìš©ì€, ë³¸ ë…¼ë¬¸ì„ ì°¸ê³ í•˜ë©´ ëœë‹¤ !:  
[ğŸ“„ Read the paper on arXiv](https://openaccess.thecvf.com/content/CVPR2023W/VAND/papers/Yang_Anomaly_Detection_With_Domain_Adaptation_CVPRW_2023_paper.pdf)